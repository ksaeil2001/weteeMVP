# F-002 과외 그룹 생성 및 매칭 – 기능 명세서 리마스터 검토본

## A. 코어 스펙

### 1. 기능 개요

F-002 "과외 그룹 생성 및 매칭"은 WeTee에서 선생님, 학생, 학부모의 관계를 **그룹(Group)** 단위로 구조화하고, **초대 코드(InviteCode)** 를 통해 서로를 안전하게 연결하는 기능이다.

이 기능의 핵심 역할은 다음과 같다.

1. 선생님이 관리 단위가 되는 과외 그룹을 생성할 수 있게 한다.
2. 각 그룹에 학생·학부모를 초대하기 위한 초대 코드를 발급한다.
3. F-001 회원가입 플로우에서 사용된 초대 코드를 기반으로 올바른 그룹 멤버십을 자동으로 생성한다.
4. 이후 기능(F-003 일정, F-004 출결, F-005 진도, F-006 정산)이 공통으로 참조하는 "그룹 기준 좌표"를 제공한다.

이 문서에서 말하는 "그룹"은 단순한 반 이름이 아니라, **일정·출결·진도·정산 데이터가 모두 귀속되는 기본 단위 컨테이너**를 의미한다.

#### 1.1 문제 정의와의 연결

문제 정의 문서에서 F-002와 직접 연결되는 핵심 문제는 다음과 같다.

* 파편화된 도구(카카오톡, 엑셀, 캘린더 등)를 동시에 사용하면서, 일정, 진도, 정산 정보가 서로 다른 곳에 저장되어 관리가 어렵다.
* 현재 현장에서는 선생님이 **과외 하나(1:1 또는 소규모 반)**를 시작할 때마다, 그 과외 참가자들을 위해 별도의 "과외용 카카오톡 단체방"을 만드는 경우가 많다. 이 방은 엄밀한 의미의 과외 그룹 구조(선생님 1명 + 학생 N명 + 각 학생의 학부모)와 항상 일치하지는 않지만, 일정 변경 안내, 숙제 공지, 정산 관련 대화 등이 한 채팅 스트림에 뒤섞여 쌓이는 공용 소통 창구로 사용된다.
* 이 구조 때문에

  * 선생님은 공지/질문/잡담을 구분해서 관리하기 어렵고,
  * 새로 합류한 학부모/학생은 과거 히스토리를 한 번에 파악하기 어렵고,
  * 나중에 특정 수업이나 특정 달의 정산 근거를 찾기 위해 카카오톡 대화 기록을 일일이 스크롤해야 한다.
* 과외 데이터가 사용자 기준(학생, 학부모, 선생님)으로만 묶여 있으면, "어떤 수업 단위에서 발생한 정보인지"가 명확히 드러나지 않는다.

따라서 WeTee는 카카오톡 단체방이 맡고 있던 역할을

* **명시적인 과외 그룹(Group) 단위**,
* 그룹에 속한 구성원 관계(GroupMember),
* 그룹을 기준으로 쌓이는 일정/출결/진도/정산 데이터,
* 그리고 그룹을 기준으로 발송되는 알림(F-008)

으로 나누어 재구성해야 한다.

이때 F-002의 역할은 다음과 같이 정의한다.

* "카카오톡 단체방 하나"에 대응하는 최소 단위를 시스템 안에서 **Group + GroupMember 구조**로 명확하게 만드는 것
* 이후 기능(F-003 일정, F-004 출결, F-005 진도, F-006 정산, F-008 알림)이 모두 이 Group을 기준으로 동작할 수 있도록, **참조 기준 좌표를 제공하는 것**

#### 1.2 범위(Scope)

포함되는 범위는 다음과 같다.

* 선생님 기준 과외 그룹 생성, 수정, 삭제(삭제는 조건부 허용)
* 선생님 기준 "내 과외 그룹" 리스트 조회
* 모든 사용자 기준 "내가 속한 과외 그룹" 리스트 조회
* 선생님에 의한 학생·학부모 초대 코드 생성
* 초대 코드 사용 시 그룹 멤버십(GroupMember) 생성 로직
* 그룹 멤버십의 기본 생성/조회 규칙 정의

다른 기능에서 상세 정의하는 범위(이 문서에서는 개요만 언급):

* F-003 수업 일정 관리: Group 기준으로 수업 일정(Schedule) 관리
* F-004 출결 관리: Group + Schedule 기준 출결 기록 관리
* F-005 수업 기록 및 진도 관리: Group 기준 수업 내용 및 교재 진도 관리
* F-006 수업료 정산: Group 기준 수업료·납부 내역 관리

이 문서에서는 위 기능들과의 연계 전제만 정의하고, 각 기능의 세부 로직은 해당 기능 명세서에서 정의한다.

#### 1.3 카카오톡 대체 관점에서의 F-002 역할

여기서 말하는 "과외용 카카오톡 단체방"은, 선생님이 특정 과외(1:1 또는 소규모/그룹 과외)를 위해 별도로 만든 채팅방 한 개를 가리킨다. 이런 방은 과외마다 구성(학생 수, 학부모 포함 여부, 방 개수)은 다를 수 있지만, 대체로 다음과 같은 역할을 동시에 맡는다.

* 누가 이 과외에 참여하는지(선생님/학생/학부모 구성 파악)
* 언제 수업이 있는지, 일정 변경 안내
* 숙제/자료 전달 및 진도 관련 공지
* 결제 요청 및 입금 확인에 대한 안내

F-002는 이 중 첫 번째 축, 즉 "이 과외에 누가 묶여 있는가?"를 시스템 안에서 **명시적인 Group/GroupMember 구조**로 대체한다. 이후 기능들은 다음과 같이 카카오톡 단체방이 맡고 있던 나머지 역할을 나누어 담당한다.

* 일정/변경 안내 → F-003 수업 일정 관리 + F-008 알림
* 숙제/진도 공유 → F-005 수업 기록 및 진도 관리 + F-008 알림
* 결제/입금 안내 → F-006 수업료 정산 + F-008 알림

즉, F-002는 "카카오톡 단체방이라는 느슨한 단위"를 "시스템 안의 Group + GroupMember"라는 명시적 구조로 치환하고,

* 선생님 입장에서는 "새 과외를 시작할 때, 카카오톡 단체방을 만드는 대신 WeTee에서 과외 그룹을 만드는 것"이 기본 루틴이 되도록 하는 것,
* 학생/학부모 입장에서는 "과외와 관련된 정보는 카카오톡 대화 기록이 아니라 WeTee의 그룹 기반 화면에서 확인하는 것"이 기본 경험이 되도록 하는 것

을 성공 기준으로 삼는다.

#### 1.4 문제 정의(P1~P8)와의 매핑

`01_문제_정의_및_목표_설정`에서 정리한 문제 ID(P1~P8) 중, F-002가 직접 또는 간접적으로 다루는 항목은 다음과 같다.

* **P1 도구 파편화·인지 부하 (선생님)**

  * F-002는 각 과외를 **Group 단위**로 정의하고, 이후 일정/출결/진도/정산/알림이 모두 `group_id`를 기준으로 생성되도록 강제한다.
  * 결과적으로 선생님 입장에서는 "학생별 카카오톡 방 + 엑셀 + 캘린더" 조합 대신, "그룹 카드 하나"를 중심으로 과외를 관리하는 구조를 만들기 위한 기반이 된다.

* **P2 일정 조율 및 보강 수업 관리의 복잡성**

  * P2의 직접 해결자는 F-003(일정 관리)이지만, F-002에서 선생님이 운영하는 그룹들의 목록과 멤버 구성을 명시적으로 관리하기 때문에, 일정은 항상 **특정 그룹/멤버셋**을 기준으로 생성된다.
  * 이 구조 덕분에 "누구와 어떤 과외에서 잡힌 일정인지"가 헷갈리는 상황을 줄이고, 보강/취소/변경 로직을 그룹 단위로 일관되게 설계할 수 있다.

* **P3/P5 수업료 정산·돈 흐름/비공식 거래 위험**

  * 수업료 계산·청구·결제 흐름 자체는 F-006의 역할이지만, F-002에서 정의한 **Group / GroupMember 관계**가 "이 수업료가 어느 과외·어느 학생·어느 학부모와 연결되어 있는지"를 추적하는 키가 된다.
  * 정산 로그가 `group_id`와 `member_role`에 묶여 저장되어야, 나중에 분쟁(P5) 발생 시 어떤 과외·어떤 기간·어떤 구성원에 대한 돈 흐름인지 맥락을 복원할 수 있다.

* **P4/P6 진도 공유·소통·신뢰 부족**

  * F-002는 학생/학부모가 어떤 그룹과 어떤 학생 관계로 연결되어 있는지를 `GroupMember.member_role` 및 `linked_student_id` 필드에 명시한다.
  * F-005/F-008에서 진도 리포트·알림을 보낼 때, "어느 학부모에게 어떤 내용이 가야 하는지"를 정확히 결정하기 위한 기준이 되며, 이는 학부모 입장에서 **내 자녀와 관련된 정보만 정확히 받는다**는 신뢰(P4, P6)에 기여한다.

* **P7 숙제 관리의 번거로움**

  * 숙제 관리 기능(F-00X)은 F-002에서 정의한 그룹/멤버십 구조 위에서 동작한다.
  * 과외 그룹이 명확히 정의되어 있어야, 숙제 기록이 카카오톡 사진/텍스트에 흩어지지 않고 "어느 과외에서 나온 숙제인지"가 일관되게 연결될 수 있다.

* **P8 학생 구인 및 홍보의 어려움**

  * F-002는 P8의 직접 해결 기능은 아니지만, 장기적으로는 그룹 단위로 쌓인 일정·진도·정산 기록이 선생님 포트폴리오와 매칭 시스템(F-00X)에 재사용될 수 있도록 **데이터의 최소 단위(과외 세트)**를 제공한다.

정리하면, F-002는 P1·P2에 대해서는 **직접적으로 도구 파편화와 일정 혼란을 줄이기 위한 구조를 제공**하고, P3·P4·P5·P6·P7·P8에 대해서는 다른 기능(F-003~F-008, F-00X)이 문제를 해결할 수 있도록 **관계·단위·추적 가능성을 제공하는 인프라 역할**을 한다.

### 2. 용어 정의

#### 2.1 Group (과외 그룹)

* 한 명의 선생님이 특정 학생 세트에게 수업을 제공하기 위해 운영하는 **수업 단위 컨테이너**.
* 예시

  * "김학생 수학 1:1 과외"
  * "고3 수능 영어반"
* 주요 역할

  * 일정, 출결, 진도, 정산 데이터가 연결되는 기준 단위
  * 학생·학부모 초대 코드가 연결되는 단위

#### 2.2 GroupMember (그룹 멤버십)

* 특정 사용자가 특정 그룹에 소속되는 관계를 나타내는 엔티티.
* 한 사용자는 여러 그룹에 속할 수 있고, 각 관계는 별도의 GroupMember 레코드로 표현된다.
* 예시

  * 한 학생이 수학 그룹과 영어 그룹 두 개에 동시에 속한 경우, GroupMember가 2개 생성된다.

#### 2.3 MemberRole (그룹 내 역할)

GroupMember에서 사용하는 역할 구분 값이다.

* `TEACHER`: 그룹을 생성하고 운영하는 선생님. 한 그룹에 정확히 1명 존재한다.
* `STUDENT`: 수업을 받는 학생. 한 그룹에 여러 명 존재할 수 있다.
* `PARENT`: 학생의 보호자. 한 학생에 대해 여러 명의 보호자가 존재할 수 있다.

#### 2.4 InviteCode (초대 코드)

* 선생님이 학생 또는 학부모를 특정 그룹에 초대하기 위해 발급하는 코드.
* 문자/숫자 조합의 6자리 정도를 기본으로 한다(예: "AB12CD").
* 초대 코드 자체의 생성/검증/만료 로직은 F-001에서 정의하며, F-002에서는 다음과 같은 메타데이터 활용 방식을 규정한다.

  * 이 코드가 어떤 그룹(group_id)과 연결되는지
  * 이 코드가 어떤 역할(target_role: STUDENT 또는 PARENT)을 위한 것인지
  * 이 코드가 특정 학생의 학부모를 위한 코드인 경우, 어떤 학생(target_student_id)과 연결되는지

#### 2.5 GroupStatus (그룹 상태)

MVP에서는 다음 두 가지 상태를 정의한다.

* `ACTIVE`: 운영 중인 그룹
* `ARCHIVED`: 보관 처리된 그룹(2단계 이상에서 실제 기능 도입 가능).

MVP 1단계에서는 대부분 그룹이 `ACTIVE` 상태로만 사용된다. 필요하다면 스키마에 필드를 미리 정의해 둘 수 있다.

### 3. 사용자 시나리오 (UI 표현 제거 버전)

이 섹션에서는 버튼, 화면 전환 등 UI 표현은 최대한 배제하고, "사용자가 무엇을 할 수 있는지"만 기술한다.

#### 3.1 F-002-UC-01 선생님의 첫 과외 그룹 생성

**목적**
신규 가입한 선생님이 첫 번째 과외 그룹을 생성하여, 이후 일정·출결·진도·정산이 연결될 기준 `group_id`를 확보한다.

**기본 흐름**

1. 선생님은 로그인 상태에서 "새 과외 그룹 만들기" 기능을 호출한다.
2. 시스템은 다음 필수 정보를 전달받는다.

   * 그룹 이름(name)
   * 과목(subject)
   * 수업 방식(teaching_mode)
3. 시스템은 다음 선택 정보를 전달받을 수 있다.

   * 회당 수업료(tuition_per_session)
   * 기본 수업 시간(default_duration_min)
4. 시스템은 필수 필드의 값이 존재하는지, 길이 제한을 만족하는지, 값의 범위가 유효한지 검증한다.
5. 검증이 통과되면 시스템은 다음 작업을 순서대로 수행한다.

   * Group 레코드를 생성한다.
   * GroupMember 레코드를 생성하고, 현재 사용자(User.id)를 이 Group의 `TEACHER` 역할로 등록한다.
6. 선생님은 생성된 그룹의 기본 정보를 조회할 수 있다.
7. 다른 기능(F-003~F-006)은 이 `group_id`를 기준으로 데이터를 생성한다.

#### 3.2 F-002-UC-02 선생님의 추가 과외 그룹 생성

**목적**
이미 하나 이상의 그룹을 보유한 선생님이 다른 학생 또는 다른 과목/반을 위한 그룹을 추가로 생성한다.

**기본 흐름**

1. 선생님은 "새 과외 그룹 만들기" 기능을 다시 호출한다.
2. UC-01과 동일한 필수/선택 정보를 입력한다.
3. 시스템은 같은 선생님이 기존에 사용한 그룹 이름과 동일한 이름을 사용할 경우, 중복에 대한 경고 메시지를 반환할 수 있다. 단, 이름이 중복된다고 해서 생성 자체를 막지는 않는다.
4. Group 및 GroupMember(TEACHER) 레코드를 추가로 생성한다.
5. 선생님은 본인이 운영 중인 여러 그룹을 리스트 형태로 조회할 수 있다.

#### 3.3 F-002-UC-03 선생님의 학생 초대 코드 생성

**목적**
선생님이 특정 그룹에 학생을 초대하기 위해, 학생용 초대 코드를 생성한다.

**기본 흐름**

1. 선생님은 학생을 초대할 그룹을 선택한다.
2. 선생님은 "학생 초대 코드 생성" 기능을 호출한다.
3. 시스템은 해당 그룹에 대해 현재 `status=ISSUED` 상태인 초대 코드 개수를 조회한다.
4. 시스템은 사전에 정의된 최대 허용 개수(예: 그룹당 10개)를 초과했는지 확인한다.
5. 허용 범위 이내라면, 시스템은 InviteCode 레코드를 생성한다.

   * issuer_teacher_id = 현재 선생님의 User.id
   * group_id = 선택된 그룹의 id
   * target_role = STUDENT
   * max_use_count = 1
   * status = ISSUED
   * expires_at = 생성 시점 기준 7일 후(값은 설정으로 조정 가능)
6. 시스템은 생성된 초대 코드 값(code)과 유효 기간 정보를 선생님에게 반환한다.
7. 선생님은 이 코드를 메신저, 문자 등 원하는 수단을 통해 학생 또는 학부모에게 전달한다.

#### 3.4 F-002-UC-04 선생님의 학부모 초대 코드 생성

**목적**
이미 그룹에 속해 있는 특정 학생의 학부모를 초대하기 위해, 학부모용 초대 코드를 생성한다.

**기본 흐름**

1. 선생님은 학부모를 연결할 그룹을 선택한다.
2. 선생님은 해당 그룹에 속한 학생 목록 중, 초대하려는 학생을 선택한다.
3. 선생님은 "학부모 초대 코드 생성" 기능을 호출한다.
4. 시스템은 선택된 그룹과 학생에 대해 `status=ISSUED` 상태인 학부모 초대 코드 수를 조회한다.
5. 시스템은 한 학생당 허용 가능한 학부모 초대 코드 개수(예: 3개)를 초과했는지 확인한다.
6. 허용 범위 이내라면, 시스템은 InviteCode 레코드를 생성한다.

   * issuer_teacher_id = 현재 선생님의 User.id
   * group_id = 선택된 그룹의 id
   * target_role = PARENT
   * target_student_id = 선택된 학생의 User.id
   * max_use_count = 2(예: 부모 2명까지 허용하는 정책. 실제 값은 설정으로 조정 가능)
   * status = ISSUED
   * expires_at = 생성 시점 기준 7일 후
7. 시스템은 초대 코드 값과 유효 기간, 어떤 학생의 학부모용 코드인지에 대한 정보를 선생님에게 반환한다.
8. 선생님은 이 코드를 학부모에게 전달한다.

#### 3.5 F-002-UC-05 초대 코드 사용 시 그룹 멤버십 생성

**목적**
학생 또는 학부모가 F-001 회원가입 과정에서 초대 코드를 입력할 때, 해당 코드 정보를 기반으로 올바른 그룹 멤버십을 자동으로 생성한다.

**기본 흐름(요약)**

1. 학생 또는 학부모는 F-001에서 정의된 회원가입 API(`/auth/register`)를 호출하면서 초대 코드를 함께 제출한다.
2. F-001의 로직은 초대 코드의 존재 여부, 만료 여부, 사용 가능 여부를 검증한다.
3. 초대 코드가 유효한 경우, F-001은 User 엔티티를 생성하고 사용자 역할을 설정한다.
4. 회원가입이 성공하면, F-001은 초대 코드에 포함된 메타데이터(group_id, target_role, target_student_id 등)를 기반으로 F-002 도메인 서비스에 "그룹 멤버십 생성"을 요청한다.
5. F-002 도메인 서비스는 다음 규칙에 따라 GroupMember를 생성한다.

   * target_role이 STUDENT인 경우

     * GroupMember(group_id, user_id=새로 생성된 학생, member_role=STUDENT)를 생성한다.
   * target_role이 PARENT인 경우

     * GroupMember(group_id, user_id=새로 생성된 학부모, member_role=PARENT)를 생성한다.
     * 필요 시, 학생과 학부모를 연결하는 별도의 연관 관계(예: StudentParentLink)를 동시에 생성한다.
6. InviteCode의 사용 횟수(used_count)를 증가시키고, max_use_count에 도달하면 상태를 USED로 변경한다.
7. 이후 학생과 학부모는 로그인 후 "내 과외 그룹" 또는 "자녀의 과외" 화면에서 해당 그룹을 확인할 수 있다.

역할이 일치하지 않는 상황(예: 학생용 코드로 학부모가 가입 시도)은 F-001의 초대 코드 검증 단계에서 차단하며, 에러 코드는 공통 규칙에 따라 정의한다.

#### 3.6 F-002-UC-06 그룹 삭제

**목적**
더 이상 사용하지 않는 그룹을 삭제하되, 학생/학부모 데이터 손실과 실수 삭제를 방지한다.

**기본 흐름**

1. 선생님은 삭제하려는 그룹에 대해 "그룹 삭제" 기능을 호출한다.
2. 시스템은 해당 그룹에 속한 GroupMember 레코드 중에서 `member_role`이 STUDENT 또는 PARENT인 레코드가 존재하는지 확인한다.
3. STUDENT 또는 PARENT 멤버십이 하나라도 존재하면, 시스템은 그룹 삭제를 허용하지 않고 적절한 에러를 반환한다.
4. STUDENT와 PARENT 멤버십이 모두 존재하지 않는 경우, 시스템은 Group 레코드를 삭제한다.

   * 물리 삭제 또는 논리 삭제 중 어떤 방식을 사용할지는 전체 시스템 정책에 따라 결정한다.
5. 그룹이 삭제될 때, 해당 그룹과 연결된 초대 코드의 상태는 정책에 따라 만료(EXPIRED) 처리하거나, 참조용으로 남겨둘 수 있다.

### 4. 비즈니스 규칙

#### 4.1 그룹 생성 규칙

* 필수 입력 값

  * 그룹 이름(name)

    * 최소 2자 이상, 최대 50자 이하
  * 과목(subject)

    * 사전에 정의된 과목 코드 중 하나(예: KOREAN, ENGLISH, MATH 등)
  * 수업 방식(teaching_mode)

    * `OFFLINE`, `ONLINE`, `MIXED` 중 하나
* 선택 입력 값

  * 회당 수업료(tuition_per_session)

    * 0 이상인 정수
    * 상한 값(예: 10,000,000원)을 초과할 경우 비정상적인 값으로 간주하고 에러 또는 경고 처리
  * 기본 수업 시간(default_duration_min)

    * 0보다 큰 정수(분 단위)

같은 선생님이 동일한 이름의 그룹을 여러 개 생성하는 것은 허용한다. 단, 사용자가 혼동하지 않도록 같은 이름의 그룹이 이미 존재한다는 안내 메시지를 표시할 수 있다.

#### 4.2 초대 코드 규칙

* 코드 형식

  * 길이 6자리
  * 영문 대문자와 숫자의 조합을 사용한다.
* 유효 기간

  * 기본값은 생성 시점 기준 7일로 설정한다.
  * 환경 설정에 따라 변경 가능하다.
* 사용 횟수

  * 학생용 코드(target_role=STUDENT)

    * max_use_count = 1로 설정한다.
  * 학부모용 코드(target_role=PARENT)

    * 기본값을 2로 설정하여, 부모 2명까지 사용할 수 있게 할 수 있다.
    * 실제 값은 서비스 정책에 따라 조정 가능하다.
* 역할 일치 규칙

  * target_role이 STUDENT인 초대 코드는 학생 역할로 가입할 때만 사용할 수 있다.
  * target_role이 PARENT인 초대 코드는 학부모 역할로 가입할 때만 사용할 수 있다.
* 대기 중 초대 개수 제한

  * 그룹당 `status=ISSUED` 상태의 초대 코드 개수는 최대 10개로 제한한다.
* 상태 전환 규칙

  * ISSUED 상태에서 첫 사용 시 used_count를 1 증가시킨다.
  * used_count가 max_use_count에 도달하면 status를 USED로 변경한다.
  * expires_at을 기준으로 유효 기간이 지났을 경우 status를 EXPIRED로 변경한다.

#### 4.3 그룹 멤버십 규칙

* TEACHER 멤버십

  * Group이 생성될 때 자동으로 생성된다.
  * 한 그룹에는 TEACHER 역할의 GroupMember가 정확히 1개만 존재해야 한다.
* STUDENT 멤버십

  * 학생은 초대 코드 사용을 통해서만 그룹에 추가된다.
  * 한 학생은 여러 그룹에 동시에 속할 수 있다.
* PARENT 멤버십

  * 학부모는 초대 코드 사용을 통해 그룹에 추가된다.
  * PARENT 멤버십은 반드시 특정 학생과 연결되어야 하며, `linked_student_id` 또는 이에 준하는 필드로 표현한다.
  * 한 학생에 여러 명의 학부모가 연결될 수 있다.
* 탈퇴 및 삭제

  * 학생/학부모의 그룹 탈퇴 기능은 향후 확장 기능으로 정의할 수 있다.
  * TEACHER는 그룹 삭제를 통해서만 그룹에서 빠질 수 있다. 이때 학생/학부모 멤버십이 없어야 삭제가 가능하다.

#### 4.4 그룹 관리 규칙

* 그룹 정보 수정

  * 선생님은 그룹 이름, 과목, 수업 방식, 회당 수업료, 기본 수업 시간 등을 수정할 수 있다.
  * 수정 권한은 해당 그룹의 TEACHER에게만 부여된다.
* 그룹 삭제

  * 그룹 삭제는 STUDENT 및 PARENT 멤버십이 모두 없는 경우에만 허용한다.
  * 삭제 후 복구 기능은 MVP 1단계에서는 제공하지 않는다. 복구 기능이 필요할 경우 `ARCHIVED` 상태 전환 방식으로 확장할 수 있다.

### 5. 데이터/상태 정의

#### 5.1 Group 엔티티

예시 필드는 다음과 같다.

* id: UUID
* teacher_id: User.id (그룹을 생성한 선생님의 id)
* name: 문자열, 그룹 이름
* subject: 문자열, 과목 코드
* teaching_mode: 문자열, `OFFLINE` / `ONLINE` / `MIXED`
* tuition_per_session: 정수, 회당 수업료(원 단위)
* default_duration_min: 정수, 기본 수업 시간(분 단위)
* status: 문자열, `ACTIVE` / `ARCHIVED`
* created_at: 생성 시각
* updated_at: 마지막 수정 시각

제약 조건 예시

* (teacher_id, name)에 대한 유니크 제약은 두지 않는다. 같은 이름의 그룹 여러 개를 허용한다.

#### 5.2 GroupMember 엔티티

예시 필드는 다음과 같다.

* id: UUID
* group_id: Group.id
* user_id: User.id
* member_role: 문자열, `TEACHER` / `STUDENT` / `PARENT`
* status: 문자열, `ACTIVE` / `LEFT` / `REMOVED` 등
* linked_student_id: User.id 또는 별도 Student 엔티티의 id(학부모인 경우 필수)
* joined_at: 그룹에 가입한 시각
* left_at: 그룹에서 탈퇴하거나 제거된 시각(선택)

특이사항

* TEACHER 역할의 GroupMember는 그룹당 정확히 1개여야 한다.
* PARENT 역할의 GroupMember는 `linked_student_id`가 반드시 존재해야 한다.

#### 5.3 InviteCode 엔티티 (F-002 관점)

F-001에서 정의한 InviteCode 엔티티 중, F-002에서는 다음 필드들을 특히 중요하게 사용한다.

* code: 문자열, 실제 초대 코드 값
* issuer_teacher_id: User.id, 초대 코드를 발급한 선생님
* target_role: 문자열, STUDENT 또는 PARENT
* group_id: Group.id, 코드가 연결된 그룹
* target_student_id: User.id 또는 Student 엔티티 id, 학부모용 코드일 때 연결되는 학생
* max_use_count: 정수, 최대 사용 가능 횟수
* used_count: 정수, 현재까지 사용된 횟수
* status: 문자열, `ISSUED` / `USED` / `EXPIRED`
* expires_at: 유효 기간 만료 시각

F-002 도메인 서비스는 위 필드를 이용해 GroupMember 생성 및 학부모–학생 연결을 수행한다.

### 6. API 요약 (제안)

실제 URL prefix(`/api/v1`) 등은 프로젝트 전반의 규칙에 맞추어 조정한다.

#### 6.1 POST /groups

* 설명: 선생님이 새 과외 그룹을 생성한다.
* 권한: TEACHER 역할 사용자만 호출 가능하다.

요청 바디 예시

* name: string, 필수
* subject: string, 필수
* teaching_mode: string, 필수
* tuition_per_session: number, 선택
* default_duration_min: number, 선택

응답 예시

* group_id
* name
* subject
* teaching_mode
* tuition_per_session
* default_duration_min
* teacher_id

#### 6.2 GET /groups/my

* 설명: 현재 로그인한 사용자의 "내 과외 그룹" 리스트를 조회한다.
* 동작 규칙

  * TEACHER 역할: 자신이 TEACHER로 속한 그룹 목록을 반환한다.
  * STUDENT 역할: 자신이 STUDENT로 속한 그룹 목록을 반환한다.
  * PARENT 역할: 자신이 PARENT로 속한 그룹 목록을 반환한다.

#### 6.3 GET /groups/{group_id}

* 설명: 특정 그룹의 기본 정보를 조회한다.
* 포함 정보 예시

  * 그룹 이름, 과목, 수업 방식
  * 학생 수 요약, 학부모 연결 여부 요약

#### 6.4 PATCH /groups/{group_id}

* 설명: 선생님이 그룹 이름, 과목, 수업 방식, 수업료, 기본 수업 시간 등을 수정한다.
* 권한: 해당 그룹의 TEACHER만 호출 가능하다.

#### 6.5 DELETE /groups/{group_id}

* 설명: 학생/학부모가 존재하지 않는 그룹을 삭제한다.
* 사전 조건: 해당 그룹에 STUDENT 또는 PARENT 역할의 GroupMember가 없어야 한다.

#### 6.6 GET /groups/{group_id}/members

* 설명: 특정 그룹에 속한 멤버 리스트를 조회한다.
* 권한 및 응답 범위

  * TEACHER: 해당 그룹의 모든 멤버(선생님, 학생, 학부모)를 조회할 수 있다.
  * STUDENT: 본인의 정보와, 서비스 정책이 허용하는 범위의 요약 정보만 조회할 수 있다.
  * PARENT: 본인의 정보와 자녀와 관련된 멤버 정보(예: 같은 그룹 학생 수)를 요약 형태로 조회할 수 있다.

#### 6.7 GET /groups/{group_id}/invites

* 설명: 특정 그룹에 대해 `status=ISSUED` 상태인 초대 코드 목록을 조회한다.
* 필터 조건

  * target_role(STUDENT 또는 PARENT)로 필터링할 수 있다.

초대 코드 생성 API 자체는 F-001의 `/auth/invite` 엔드포인트를 재사용하며, F-002에서 정의한 group_id, target_role, target_student_id 필드를 요청 바디에 포함하는 것을 전제로 한다.

### 7. 권한 및 접근 제어 요약

역할별 허용 행동을 표로 정리하면 다음과 같다.

| 기능/행동                                   | TEACHER            | STUDENT   | PARENT    |
| --------------------------------------- | ------------------ | --------- | --------- |
| 그룹 생성 (POST /groups)                    | 가능                 | 불가        | 불가        |
| 내 그룹 리스트 조회 (GET /groups/my)            | 가능                 | 가능        | 가능        |
| 그룹 상세 조회 (GET /groups/{id})             | 가능                 | 소속 그룹만 가능 | 소속 그룹만 가능 |
| 그룹 정보 수정 (PATCH /groups/{id})           | 가능(해당 그룹 TEACHER만) | 불가        | 불가        |
| 그룹 삭제 (DELETE /groups/{id})             | 가능(조건 충족 시)        | 불가        | 불가        |
| 그룹 멤버 리스트 조회 (GET /groups/{id}/members) | 전체 조회 가능           | 제한적 조회    | 제한적 조회    |
| 초대 코드 생성 (/auth/invite 호출)              | 가능                 | 불가        | 불가        |

여기서 "제한적 조회"는 서비스 정책에 따라 구체적으로 정의하며, 예를 들어 학생이 다른 학생의 이름을 볼 수 있는지 여부 등은 별도 개인정보 정책에서 정한다.

### 8. 화면 흐름 연계 (고수준, ID 예시)

이 섹션은 기능 명세와 UI 간의 연결 관계를 이해하기 위한 고수준 매핑이다. 실제 화면 ID는 UI/UX 명세서에서 확정한다.

| 유즈케이스 ID              | 시작 지점(역할 기준)       | 중간 단계(기능 기준)          | 결과 상태(주요 화면)                  |
| --------------------- | ------------------ | --------------------- | ----------------------------- |
| F-002-UC-01 첫 그룹 생성   | 선생님 대시보드(예: S-010) | 그룹 생성 폼(예: S-020)     | 그룹 상세 화면(예: S-021, 학생 0명)     |
| F-002-UC-02 추가 그룹 생성  | 선생님 대시보드(S-010)    | 그룹 생성 폼(S-020)        | 그룹 상세 화면(S-021)               |
| F-002-UC-03 학생 초대 코드  | 그룹 상세 화면의 학생 영역    | 초대 코드 생성/표시(S-022)    | 그룹 상세 화면(S-021, 초대 상태 표시)     |
| F-002-UC-04 학부모 초대 코드 | 그룹 상세 화면의 학생 상세 영역 | 초대 코드 생성/표시(S-022)    | 그룹 상세 화면(S-021, 학부모 연결 예정 표시) |
| F-002-UC-05 멤버십 생성    | F-001 회원가입 플로우     | 서버 측 도메인 로직(별도 화면 없음) | 역할별 대시보드의 그룹 카드 노출            |
| F-002-UC-06 그룹 삭제     | 그룹 상세 화면(S-021)    | 삭제 확인 다이얼로그(예: S-023) | 선생님 대시보드(S-010, 리스트에서 제거)     |

### 9. 예외 상황 및 에러 처리

에러 코드는 실제 구현 시 공통 에러 코드 정책에 맞추어 조정한다. 이 문서에서는 이해를 돕기 위한 예시를 제시한다.

#### 9.1 그룹 관련 에러 코드 예시

| 에러 코드 이름                 | 발생 조건                         | 설명 메시지 예시                       |
| ------------------------ | ----------------------------- | ------------------------------- |
| GROUP_NAME_REQUIRED      | 그룹 이름이 비어 있는 상태로 그룹 생성/수정 요청  | "그룹 이름을 입력해주세요."                |
| GROUP_SUBJECT_REQUIRED   | 과목이 선택되지 않은 상태로 그룹 생성/수정 요청   | "과목을 선택해주세요."                   |
| GROUP_NAME_TOO_SHORT     | 그룹 이름 길이가 최소 길이(2자) 미만        | "그룹 이름은 2자 이상이어야 합니다."          |
| GROUP_NAME_TOO_LONG      | 그룹 이름 길이가 최대 길이(50자)를 초과      | "그룹 이름은 50자 이하로 입력해주세요."        |
| GROUP_TUITION_TOO_LARGE  | 회당 수업료가 상한값을 초과               | "수업료가 너무 큽니다. 다시 확인해주세요."       |
| GROUP_DELETE_HAS_MEMBERS | 학생 또는 학부모 멤버십이 존재하는 그룹 삭제 시도  | "학생 또는 학부모가 있는 그룹은 삭제할 수 없습니다." |
| GROUP_NOT_FOUND          | 존재하지 않는 group_id로 조회/수정/삭제 요청 | "존재하지 않는 과외 그룹입니다."             |
| GROUP_FORBIDDEN          | 접근 권한이 없는 그룹에 대한 조회/수정/삭제 요청  | "이 과외 그룹에 접근할 수 있는 권한이 없습니다."   |

#### 9.2 초대 코드 관련 에러 코드 예시

| 에러 코드 이름                    | 발생 조건                                 | 설명 메시지 예시                                       |
| --------------------------- | ------------------------------------- | ----------------------------------------------- |
| INVITE_GROUP_LIMIT_EXCEEDED | 특정 그룹에 대해 허용된 최대 대기 초대 수를 초과하여 생성 시도  | "대기 중인 초대 코드가 너무 많습니다. 기존 초대를 정리한 후 다시 시도해주세요." |
| INVITE_ROLE_MISMATCH        | 초대 코드의 target_role과 가입하려는 사용자의 역할이 다름 | "이 초대 코드는 현재 선택한 역할로는 사용할 수 없습니다."              |
| INVITE_ALREADY_USED         | 이미 max_use_count를 모두 사용한 코드로 가입 시도    | "이미 사용된 초대 코드입니다. 선생님께 새 코드를 요청해주세요."           |
| INVITE_EXPIRED              | expires_at을 기준으로 유효 기간이 지난 코드로 가입 시도  | "만료된 초대 코드입니다. 선생님께 새 코드를 요청해주세요."              |

### 10. 비기능 요구사항 (그룹/매칭 영역)

* 성능

  * 일반적인 사용 시 `/groups/my` 요청의 95% 이상은 500ms 이내에 응답하는 것을 목표로 한다.
* 일관성

  * GroupMember 생성과 InviteCode 상태 변경은 하나의 트랜잭션으로 처리하여, 초대 코드 사용 도중 오류가 발생하더라도 "멤버십은 생성되었는데 코드 상태는 변경되지 않은 상태"와 같은 불일치가 발생하지 않도록 한다.
* 로깅

  * 그룹 생성, 수정, 삭제
  * 초대 코드 생성 및 사용
  * 그룹 멤버십 생성 및 삭제
    와 같은 주요 이벤트는 감사 로그에 기록하여 나중에 문제 발생 시 추적이 가능하도록 한다.
* 보안

  * 사용자는 자신이 속한 그룹의 정보만 조회할 수 있다.
  * 다른 선생님이 운영하는 그룹에 대해서는 그룹 존재 여부 자체를 노출하지 않는 것을 기본 정책으로 한다.

### 11. 향후 확장 과제 (MVP 이후 검토)

다음 항목들은 F-002와 밀접하게 연관되어 있지만, MVP 1단계에서는 구현하지 않고 설계 수준에서만 언급한다.

1. 그룹 보관(Archive) 기능

   * 종료된 과외를 삭제하는 대신 `ARCHIVED` 상태로 전환하여 기록을 보존하는 기능.
   * 보관 상태에서는 일정, 출결, 진도, 정산 데이터를 읽기 전용으로 유지한다.

2. 그룹 템플릿 기능

   * "중3 수학 1:1", "고3 수능 영어반"과 같이 자주 사용하는 설정을 템플릿으로 저장하고, 새 그룹 생성 시 해당 템플릿을 불러와서 기본 값을 채우는 기능.

3. 학생 그룹 간 이동 기능

   * 한 학생을 기존 그룹에서 다른 그룹으로 이동시키는 기능.
   * 이동 시 기존 일정, 출결, 진도, 정산 데이터를 어떻게 처리할지 정책을 별도로 정해야 한다.

4. 공동 관리 그룹 기능

   * 두 명 이상의 선생님이 하나의 그룹을 함께 관리하는 기능(예: 주강사와 보조강사 구조).
   * 이 경우, GroupMember에서 TEACHER 역할을 여러 개 허용할지, 별도의 ROLE 값을 도입할지 결정해야 한다.

5. 초대 링크 및 QR 코드 확장

   * 단순 코드 문자열뿐 아니라, `wetee://join/AB12CD` 형태의 딥링크 또는 QR 코드를 통해 가입 플로우로 바로 진입할 수 있도록 확장하는 기능.
   * 이 기능은 현재 초대 코드 구조를 재사용하되, 표현 방식만 확장하는 것으로 설계할 수 있다.

## B. UI/UX 메모 (요약용)

이 섹션은 디자이너와 프론트엔드 개발자가 참고하기 위한 UI/UX 관점 메모이며, 비즈니스 로직 자체보다는 표현 방식과 화면 구성을 다룬다.

### 1. 화면 리스트 및 역할 (예시 ID)

* S-020 과외 그룹 생성 화면

  * 입력 폼: 그룹 이름, 과목, 수업 방식, 회당 수업료, 기본 수업 시간
  * 하단 고정 버튼: "그룹 만들기"

* S-021 과외 그룹 상세 화면

  * 상단: 그룹 이름, 과목 배지, 수업 방식, 요약 정보(학생 수, 다음 수업 시간 등)
  * 탭 구조 예시: 개요 / 학생 / 일정 / 출결 / 진도 / 정산
  * 학생 탭에서 "학생 초대" 및 "학부모 초대" 액션을 제공한다.

* S-022 초대 코드 표시 화면

  * 큰 글자로 초대 코드 표시
  * 유효 기간 정보(예: "7일 후 만료") 표시
  * 코드 복사 버튼, 공유 버튼 등을 제공

* 역할별 대시보드 내 그룹 섹션

  * 선생님 대시보드: "내 과외 그룹" 리스트 + "새 그룹 만들기" 버튼
  * 학생 대시보드: "내 과외 그룹" 리스트
  * 학부모 대시보드: "자녀의 과외" 리스트

### 2. 주요 컴포넌트/패턴

* 그룹 카드

  * 표시 정보 예시: 그룹 이름, 과목, 수업 방식, 학생 수, 다음 수업 시간 요약

* 빈 상태(Empty State)

  * 선생님이 운영 중인 그룹이 하나도 없는 경우: "첫 번째 과외 그룹을 만들어보세요" 메시지와 "그룹 만들기" 버튼 노출
  * 그룹에 학생이 한 명도 없는 경우: "학생을 초대해보세요" 메시지와 "학생 초대" 버튼 노출

* 초대 코드 컴포넌트

  * 고정폭 폰트로 코드를 크게 표시
  * 코드를 탭했을 때 자동 복사 후 안내 토스트 메시지 표시
  * 카카오톡, 문자 등으로 공유할 수 있는 기본 문구를 함께 제공할 수 있다.

### 3. 초기 디자인 가정

* 기본 대상 플랫폼은 모바일이며, 단일 컬럼 레이아웃을 기준으로 한다.
* 폼 화면은 "상단 제목 + 스크롤 가능한 입력 영역 + 하단 고정 CTA 버튼" 패턴을 기본으로 한다.
* 리스트 화면에서는 주요 액션(예: "새 그룹 만들기", "학생 초대")을 상단 또는 우측 하단 플로팅 버튼으로 노출하여, 자연스럽게 "그룹 생성 → 학생 초대" 흐름을 유도한다.
