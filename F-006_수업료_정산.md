# F-006: 수업료 정산

**버전**: v1.1  
**작성일**: 2025-11-04  
**최종 수정일**: 2025-11-11  
**우선순위**: 1단계 MVP  
**작성자**: AI Assistant  
**주요 변경사항 (v1.1)**: 청구서 번호 형식 명시 (TUT-YYYY-NNN), 청구서 정보 구성 상세화

---

## 작성 전 체크리스트 ✅

```
[✓] 문제 정의서에서 관련 부분 다시 읽음
[✓] 경쟁 제품의 유사 기능 조사 완료
[✓] 이 기능과 연결된 다른 기능 목록 작성
[✓] 기술 용어 사용하지 않기로 다짐함
```

---

## 1. 이 기능은 왜 필요한가?

### 한 문장 요약
> 출결 데이터를 기반으로 수업료를 자동 계산하고, 투명한 청구서를 학부모에게 전송하여 정산의 번거로움과 금전 분쟁을 해소합니다.

### 문제 정의서와의 연결

**해결하는 문제**: 문제 3 - 정산의 번거로움과 심리적 부담

문제 정의서에서 인터뷰에 응한 선생님은 "매번 안내드리는게 좀 귀찮다. 혹은 안 보내주시면 여러번 안내드려야 함"이라고 토로했습니다. 또한 "7명 이상의 학생을 가르치면서 매번 수입을 수기로 계산하다 오류가 발생해 세네 번씩 체크하는 번거로움"을 겪었다고 합니다.

리서치에 따르면 "과외비 정산의 불편함이 반복적으로 언급"되었고, "여러 커뮤니티 글에서 과외비 선불/후불, 회차별 결제 등 다양한 지불 방식을 지닌 학생들을 관리하는 것이 큰 고민거리"였습니다.

더 심각한 것은 **문제 5: 비공식 금전 거래로 인한 법적·재정적 분쟁 위험**입니다. "과외비 환불 분쟁, 먹튀, 사기죄 논란 등의 금전적 분쟁 사례가 커뮤니티에서 자주 발견"되며, "개인 과외 시장에서 월평균 50만원 이상의 금전 거래가 현금이나 개인 계좌로 이루어지며, 이 중 약 15-20%에서 결제 지연이나 분쟁이 발생"합니다.

### 왜 다른 도구로 안 되는가?

**현재 사용자들이 쓰는 방법**:
- 방법 1: 엑셀로 수업 횟수 세고 계산기로 계산 → 한계: 매번 수동 계산, 실수 발생, 증빙 없음
- 방법 2: 카톡으로 "이번 달 O회 수업, O만원입니다" 메시지 → 한계: 기록 휘발성, 법적 효력 없음, 학부모가 검증 불가
- 방법 3: 현금 수령 후 수기 영수증 → 한계: 세금 신고 회피, 법적 위험, 증빙 부실

**경쟁 제품의 한계**:
- **수업기록노트**: 수업료 자동 계산 기능은 있지만 "선생님 개인용"이라 학부모가 확인 불가. 온라인 결제 기능 없음
- **과릿**: "정산 기능 부재" - 수업 리포트는 강점이나 돈 계산은 직접 해야 함
- **김과외**: 플랫폼 내 정산은 있지만 "첫 달 25% 수수료" + "자체 매칭만 지원" → 기존 과외에 사용 불가
- **숨고**: 매칭만 제공. "과외 후의 진행관리는 전적으로 당사자들에게 맡겨짐"

### 우리의 접근 방식

이 기능은 F-004(출결 관리)에서 기록된 데이터를 자동으로 가져와서 수업 횟수를 계산합니다. 선생님이 별도로 세지 않아도, 시스템이 "출석 O회 × 수업료"를 자동 계산하고, 학부모에게 투명한 청구서를 발송합니다. 

핵심은 **투명성**입니다. 학부모는 "어느 날 어떤 수업을 했는지" 모두 확인하고, 계산 근거를 검증할 수 있습니다. 카톡 메시지가 아닌 **시스템 내 공식 기록**이므로 분쟁 발생 시 명확한 증거가 됩니다.

---

## 2. 사용자 시나리오

### 시나리오 1: 선생님이 월말에 자동 정산 확인 (가장 기본 흐름)

**배경**: 
김선생님이 이학생과 9월 한 달간 수업을 진행했습니다. 매 수업마다 출결 체크를 했고, 이제 9월 30일이 되어 정산을 해야 합니다. 이학생의 수업료는 회당 5만원이고, 월 8회 약정입니다.

**전제 조건**:
- 김선생님은 이미 로그인되어 있다
- 이학생 그룹에 "수업료 회당 5만원, 월 8회 약정" 설정이 되어 있다
- 9월 한 달간 출결 기록이 완료되어 있다 (출석 7회, 결석 1회, 보강 1회)

**단계**:

1. 김선생님이 앱 메인 화면에서 "정산" 탭을 탭합니다
   - 화면 상단에 "9월 정산 현황" 섹션이 보입니다
   - 학생별로 카드가 나열되어 있습니다

2. 김선생님이 "이학생" 카드를 확인합니다
   - 카드에 표시된 내용:
     - **약정**: 월 8회 × 5만원 = 40만원
     - **실제**: 출석 7회 + 보강 1회 = 8회 → 40만원
     - **결석**: 1회 (9월 15일)
   - 카드 아래에 "청구서 보내기" 버튼

3. 김선생님이 "청구서 보내기" 버튼을 탭합니다
   - 청구서 미리보기 화면이 나타납니다
   - 상세 내역:
     - 9월 1일 (월) 수학 과외 - 출석 ✓
     - 9월 4일 (목) 수학 과외 - 출석 ✓
     - 9월 8일 (월) 수학 과외 - 출석 ✓
     - 9월 11일 (목) 수학 과외 - 출석 ✓
     - 9월 15일 (월) 수학 과외 - 결석 (시험 준비)
     - 9월 18일 (목) 수학 과외 - 출석 ✓
     - 9월 22일 (월) 수학 과외 - 출석 ✓
     - 9월 25일 (목) 수학 과외 - 출석 ✓
     - 9월 28일 (일) 수학 과외 - 출석 ✓ (보강)
   - 하단에 "합계: 40만원" 표시
   - "학부모에게 전송" 버튼

4. 김선생님이 "학부모에게 전송" 버튼을 탭합니다
   - 확인 팝업: "이학생 학부모님에게 9월 청구서(40만원)를 전송할까요?"
   - "전송", "취소" 버튼

5. 김선생님이 "전송"을 탭합니다
   - 성공 메시지: "청구서가 전송되었습니다"
   - 이학생 카드에 "청구서 발송 완료 (9월 30일)" 표시
   - 자동으로 이학생 학부모에게 알림 전송

**결과**:
- 이학생 학부모는 앱 알림을 받습니다: "9월 과외비 청구서가 도착했습니다 (40만원)"
- 학부모는 청구서를 앱에서 확인하고, 모든 수업 내역을 검증할 수 있습니다
- 김선생님은 별도로 카톡 메시지를 보내거나 수업 횟수를 세지 않아도 됩니다
- 청구서는 시스템에 영구 보관되어 나중에 분쟁 발생 시 증거로 활용 가능

---

### 시나리오 2: 학부모가 청구서를 확인하고 결제 (투명성 검증)

**배경**: 
이학생 학부모가 김선생님으로부터 9월 청구서를 받았습니다. 지불하기 전에 청구 내역이 맞는지 확인하고 싶습니다.

**전제 조건**:
- 이학생 학부모는 이미 로그인되어 있다
- 김선생님이 청구서를 발송했다
- 학부모는 앱 알림을 받은 상태

**단계**:

1. 학부모가 알림을 탭하거나 "정산" 탭에 들어갑니다
   - "받은 청구서" 섹션에 "9월 과외비 청구서" 카드가 있습니다
   - 카드에 표시: "김선생님 → 이학생 / 40만원 / 미결제"

2. 학부모가 청구서 카드를 탭합니다
   - 청구서 상세 화면이 나타납니다
   - 상단에 요약:
     - 기간: 2025년 9월 1일 ~ 9월 30일
     - 총 수업 횟수: 8회
     - 회당 수업료: 5만원
     - 합계: 40만원
   - 하단에 **수업 내역 리스트**:
     - 각 수업마다: 날짜, 요일, 시간, 출결 상태

3. 학부모가 수업 내역을 하나씩 확인합니다
   - "9월 15일 (월) 결석" 항목을 탭합니다
   - 해당 수업의 상세 정보가 나타납니다:
     - 선생님 메모: "시험 준비로 결석 (사전 연락 받음)"
     - 출결 기록 시각: 9월 15일 오후 3시 5분
   - 학부모는 "맞아, 그날 아이가 시험공부 한다고 했지" 확인

4. 학부모가 "결제하기" 버튼을 탭합니다
   - 결제 수단 선택 화면이 나타납니다:
     - 신용카드
     - 계좌이체
     - 간편결제 (카카오페이, 네이버페이 등)
   - 학부모가 "신용카드"를 선택합니다

5. 학부모가 카드 정보를 입력하고 "결제" 버튼을 탭합니다
   - 결제 진행 중 로딩 화면
   - 성공 메시지: "결제가 완료되었습니다"
   - 영수증 화면이 나타납니다

**결과**:
- 김선생님은 알림을 받습니다: "이학생 학부모님이 9월 과외비(40만원)를 결제하셨습니다"
- 청구서 상태가 "결제 완료"로 변경됩니다
- 영수증이 학부모와 선생님 모두에게 자동 저장됩니다
- 학부모는 투명하게 내역을 확인하고 안심하고 결제했습니다

---

### 시나리오 3: 선생님이 선불 결제 방식으로 설정 (다양한 결제 방식)

**배경**: 
김선생님이 신규 학생인 박학생을 받았습니다. 박학생 학부모와 상담 시 "선불로 한 달 치를 미리 받겠다"고 약속했습니다. 이를 시스템에 설정해야 합니다.

**전제 조건**:
- 김선생님은 이미 로그인되어 있다
- 박학생 그룹이 생성되어 있다 (F-002)
- 수업 일정이 등록되어 있다 (F-003)

**단계**:

1. 김선생님이 "그룹 관리" 화면에서 "박학생" 그룹을 선택합니다
   - 그룹 상세 화면이 나타납니다
   - "수업료 설정" 섹션이 보입니다

2. 김선생님이 "수업료 설정" 버튼을 탭합니다
   - 수업료 설정 화면이 나타납니다
   - 입력 필드:
     - **회당 수업료**: 빈 칸 (숫자 입력)
     - **결제 방식**: "후불", "선불" 선택 라디오 버튼
     - **정산 주기**: "매월 말", "4회마다", "8회마다" 등

3. 김선생님이 정보를 입력합니다
   - 회당 수업료: 6만원
   - 결제 방식: "선불" 선택
   - 정산 주기: "매월 초 (다음 달 수업료)"
   - 월 예상 수업 횟수: 8회

4. 김선생님이 "저장" 버튼을 탭합니다
   - 확인 메시지: "수업료 설정이 저장되었습니다"
   - 시스템이 자동 계산: 8회 × 6만원 = 48만원
   - 안내 메시지: "매월 1일에 자동으로 청구서가 발송됩니다"

5. 10월 1일이 되면 시스템이 자동으로 청구서를 생성합니다
   - 박학생 학부모에게 알림: "10월 과외비 청구서가 도착했습니다 (48만원, 선불)"
   - 청구서 내용:
     - 기간: 2025년 10월 예상 수업
     - 예상 횟수: 8회
     - 안내 문구: "이번 달 수업 전에 미리 결제해주시면 감사하겠습니다"

**결과**:
- 선생님은 매번 수동으로 청구하지 않아도 자동으로 선불 청구서가 발송됩니다
- 학부모는 매월 초에 규칙적으로 청구서를 받고, 월 중간에 돈 이야기를 할 필요가 없습니다
- 10월 말에는 실제 수업 횟수와 비교하여 차액 정산이 자동으로 제안됩니다

---

### 시나리오 4: 정산 수정 및 환불 처리 (예외 상황)

**배경**: 
김선생님이 최학생과 9월에 약정한 수업은 8회였는데, 최학생이 아파서 2회를 결석했습니다. 보강도 하지 못했습니다. 이 경우 실제로는 6회만 수업했으므로 차액을 환불하거나 다음 달로 이월해야 합니다.

**전제 조건**:
- 김선생님은 이미 로그인되어 있다
- 9월 출결 기록: 출석 6회, 결석 2회
- 최학생은 선불로 8회분(40만원)을 이미 결제한 상태

**단계**:

1. 김선생님이 "정산" 탭에서 "최학생" 카드를 확인합니다
   - 카드에 경고 표시: "⚠️ 약정과 실제 수업 횟수가 다릅니다"
   - 표시 내용:
     - 약정: 8회 × 5만원 = 40만원 (결제 완료)
     - 실제: 6회 × 5만원 = 30만원
     - **차액: -10만원 (환불 또는 이월 필요)**

2. 김선생님이 카드를 탭하여 상세 화면으로 들어갑니다
   - 차액 처리 옵션이 나타납니다:
     - "다음 달로 이월하기" (추천)
     - "환불 요청하기"
     - "학부모와 직접 상의하기" (메모 남기기)

3. 김선생님이 학부모와 상의하기로 하고, 메시지를 보냅니다
   - 김선생님이 "학부모와 직접 상의하기"를 선택합니다
   - 메시지 입력 화면:
     - "최학생 어머님, 9월에 2회 결석하여 실제 6회 수업했습니다. 차액 10만원을 10월 수업료에서 차감해드릴까요?"
   - "메시지 전송" 버튼

4. 학부모가 메시지를 확인하고 답장합니다
   - 학부모: "네, 10월에서 차감해주세요"

5. 김선생님이 10월 청구서 발송 시 차액을 반영합니다
   - 10월 청구서 내용:
     - 10월 예상 수업: 8회 × 5만원 = 40만원
     - 9월 이월 크레딧: -10만원
     - **10월 실제 청구 금액: 30만원**

**결과**:
- 차액 처리가 투명하게 기록되어 분쟁이 발생하지 않습니다
- 학부모는 선생님이 정직하게 처리한다고 느끼며 신뢰가 강화됩니다
- 모든 대화와 처리 내역이 시스템에 기록되어 나중에 확인 가능

---

### 시나리오 5: 선생님이 월별 수입 통계 확인

**배경**: 
김선생님이 여러 학생을 가르치고 있고, 9월 한 달간 얼마를 벌었는지 확인하고 싶습니다. 세금 신고를 위해 정확한 수입 내역이 필요합니다.

**전제 조건**:
- 김선생님은 이미 로그인되어 있다
- 9월 한 달간 5명의 학생을 가르쳤다
- 모든 청구서가 발송되었고, 일부는 결제 완료, 일부는 미결제 상태

**단계**:

1. 김선생님이 "정산" 탭에서 상단의 "통계" 버튼을 탭합니다
   - 월별 수입 통계 화면이 나타납니다
   - 기본값으로 "이번 달 (9월)" 선택되어 있음

2. 화면에 표시되는 내용을 확인합니다
   - **총 수업 횟수**: 35회
   - **총 청구 금액**: 175만원
   - **결제 완료**: 140만원 (4명)
   - **미결제**: 35만원 (1명)
   - **학생별 내역** (그래프와 표):
     - 이학생: 8회, 40만원 (결제 완료)
     - 박학생: 7회, 35만원 (미결제)
     - 최학생: 6회, 30만원 (결제 완료)
     - 정학생: 8회, 40만원 (결제 완료)
     - 강학생: 6회, 30만원 (결제 완료)

3. 김선생님이 "월별 비교" 탭을 선택합니다
   - 7월, 8월, 9월 수입이 그래프로 표시됩니다
   - 7월: 120만원, 8월: 150만원, 9월: 175만원 (증가 추세)

4. 김선생님이 "영수증 다운로드" 버튼을 탭합니다
   - 다운로드 옵션:
     - "9월 전체 영수증 (PDF)"
     - "9월 결제 완료 건만 (세금 신고용)"
   - 김선생님이 "9월 결제 완료 건만" 선택

5. PDF 파일이 생성되고 다운로드됩니다
   - 파일명: "2025년_9월_과외_수입_명세서.pdf"
   - 내용: 날짜별, 학생별 모든 거래 내역

**결과**:
- 김선생님은 수동으로 엑셀을 만들거나 계산할 필요 없이 자동으로 정리된 통계를 확인합니다
- 세금 신고 시 필요한 자료를 즉시 출력할 수 있습니다
- 월별 수입 추이를 보고 사업 계획을 세울 수 있습니다

---

## 3. 이 기능에서 일어날 수 있는 문제들

### 카테고리 1: 계산 오류 및 데이터 불일치

| 문제 상황 | 사용자에게 보여줄 메시지 | 시스템이 할 일 | 비고 |
|----------|----------------------|--------------|------|
| 출결 기록이 없는 일정이 있는 경우 | "일부 수업의 출결이 미기록 상태입니다. 먼저 출결을 체크해주세요" | 미기록 수업 목록 표시, 청구서 발송 불가 | 필수 |
| 수업료 설정이 안 된 그룹 | "수업료가 설정되지 않았습니다. 그룹 설정에서 수업료를 입력해주세요" | 수업료 설정 화면으로 안내 | |
| 약정 횟수와 실제 수업 횟수 차이가 큼 (3회 이상) | "약정 횟수와 실제 수업 횟수 차이가 큽니다. 내역을 다시 확인해주세요" | 차액 금액 명확히 표시, 처리 방법 선택 제안 | |
| 보강 수업이 정산에 포함 안 된 경우 | "보강 수업 O회가 정산에서 누락되었습니다. 포함하시겠습니까?" | 보강 수업 목록 표시, 선택 체크박스 | |
| 이전 달 미결제 청구서가 있는 경우 | "8월 청구서가 아직 미결제 상태입니다. 9월 청구서에 합산하시겠습니까?" | 합산 또는 별도 발송 선택 옵션 | |
| 계산 결과가 0원 이하인 경우 | "이번 달 수업이 없거나 크레딧이 더 많습니다. 청구서를 발송하지 않습니다" | 청구서 발송 버튼 비활성화 | |
| 청구서 발송 후 출결 기록 수정된 경우 | "출결 기록이 수정되었습니다. 청구서를 다시 발송하시겠습니까?" | 기존 청구서 취소 및 재발송 옵션 | 중요 |

### 카테고리 2: 권한 및 접근 오류

| 문제 상황 | 사용자에게 보여줄 메시지 | 시스템이 할 일 | 비고 |
|----------|----------------------|--------------|------|
| 학생이 청구서 발송 시도 | "청구서는 선생님만 발송할 수 있습니다" | 버튼 자체를 숨김 | |
| 학부모가 다른 학생의 청구서 조회 시도 | "접근 권한이 없습니다" | 에러 화면 표시, 메인으로 이동 | |
| 그룹에서 나간 학부모가 과거 청구서 조회 | "이 그룹에 더 이상 속해있지 않습니다" | 마지막 결제일까지의 청구서만 표시 | 개인정보 보호 |
| 선생님이 삭제된 그룹의 정산 조회 | "삭제된 그룹입니다. 과거 기록은 보관되어 있습니다" | 조회만 가능, 수정 불가 | 법적 보존 필요 |

### 카테고리 3: 결제 관련 오류

| 문제 상황 | 사용자에게 보여줄 메시지 | 시스템이 할 일 | 비고 |
|----------|----------------------|--------------|------|
| 결제 진행 중 네트워크 끊김 | "결제 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요" | 결제 상태 확인, 중복 결제 방지 | 필수 |
| 카드 한도 초과 | "카드 한도가 초과되었습니다. 다른 결제 수단을 선택해주세요" | 다른 결제 수단 선택 화면으로 이동 | |
| 계좌이체 시 잔액 부족 | "계좌 잔액이 부족합니다. 다른 결제 수단을 선택하거나 충전 후 다시 시도해주세요" | 결제 취소, 재시도 옵션 제공 | |
| 결제 시스템 점검 중 | "결제 시스템 점검 중입니다. O시 이후 다시 시도해주세요" | 점검 종료 예정 시간 표시 | |
| 중복 결제 시도 (연속 클릭) | "이미 결제가 진행 중입니다" | 버튼 비활성화, 한 번만 처리 | 필수 |
| 환불 요청이 불가능한 건 (7일 경과) | "결제일로부터 7일이 경과하여 환불이 불가능합니다" | 고객센터 연락 안내 | 환불 정책 |

### 카테고리 4: 청구서 발송 및 알림 오류

| 문제 상황 | 사용자에게 보여줄 메시지 | 시스템이 할 일 | 비고 |
|----------|----------------------|--------------|------|
| 학부모 연락처가 없는 경우 | "학부모 정보가 등록되지 않았습니다. 그룹 설정에서 학부모를 초대해주세요" | 초대 화면으로 안내 | |
| 알림 설정이 꺼진 학부모 | (선생님에게) "학부모님의 알림이 꺼져있어 메시지를 받지 못할 수 있습니다" | 카카오톡 또는 이메일로도 전송 | |
| 같은 청구서를 2번 발송 시도 | "이미 발송된 청구서입니다. 재발송하시겠습니까?" | 재발송 확인 팝업, 기존 청구서 취소 여부 | |
| 청구 금액이 비정상적으로 높음 (100만원 이상) | "청구 금액이 평소보다 많습니다. 내역을 다시 확인하시겠습니까?" | 내역 재확인 화면, 발송 대기 | 사기 방지 |

### 카테고리 5: 네트워크 및 시스템 오류

| 문제 상황 | 사용자에게 보여줄 메시지 | 시스템이 할 일 | 비고 |
|----------|----------------------|--------------|------|
| 네트워크 연결 끊김 | "네트워크 연결을 확인해주세요" | "다시 시도" 버튼 제공, 입력 데이터 보존 | 필수 |
| 서버 응답 지연 | "잠시만 기다려주세요..." | 로딩 스피너 표시, 30초 후 타임아웃 | |
| 청구서 PDF 생성 실패 | "청구서 생성 중 오류가 발생했습니다. 다시 시도해주세요" | 오류 로그 기록, 재시도 버튼 | |
| 대용량 데이터 로딩 지연 (수년간 기록) | "과거 기록을 불러오는 중입니다..." | 최근 6개월만 먼저 로드, 나머지는 스크롤 시 | 성능 최적화 |

---

## 4. 비즈니스 규칙

### 규칙 그룹 1: 수업료 설정 제약사항

- **회당 수업료 범위**: 최소 1만원, 최대 50만원
  - 비정상적으로 높거나 낮은 금액 방지
- **결제 방식**: "선불", "후불" 중 택일 필수
  - 혼용 불가, 변경 시 다음 달부터 적용
- **정산 주기**: "매월 말", "4회마다", "8회마다", "12회마다" 중 선택
  - 주기는 그룹 생성 시 설정, 이후 변경 가능하나 진행 중인 정산에는 영향 없음
- **수업료 변경**: 현재 진행 중인 달에는 변경 불가, 다음 달부터 적용
  - 예: 9월 15일에 수업료 변경하면 10월 1일부터 적용

### 규칙 그룹 2: 청구서 발송 규칙

- **청구서 번호 형식**:
  - 형식: `TUT-{연도}-{순번}`
  - 예시: `TUT-2025-001`, `TUT-2025-002`, `TUT-2025-123`
  - 순번은 **연도별**로 1부터 시작 (매년 1월 1일 초기화)
  - 순번은 **전체 시스템**에서 unique (모든 선생님 공통)
  - 3자리 고정 (001, 002, ..., 999)
  - 10,000번째부터는 4자리로 자동 확장 (TUT-2025-10000)
  
- **자동 발송 시점**: 
  - 후불: 매월 마지막 날 오후 9시
  - 선불: 매월 1일 오전 9시
  
- **수동 발송 제한**: 같은 달에 대해 한 번만 가능
  - 재발송 시 기존 청구서는 자동 취소되며, 새 청구서 번호 발급
  
- **청구서 유효 기간**: 발송일로부터 30일
  - 30일 경과 후 미결제 시 "연체" 표시
  
- **최소 청구 금액**: 1만원 이상
  - 1만원 미만은 다음 달로 자동 이월
  
- **청구서 정보 구성**:
  - 청구서 번호 (예: TUT-2025-001)
  - 발행일자 (예: 2025년 9월 30일)
  - 발행인: 선생님 이름, 전화번호
  - 수신인: 학부모 이름, 학생 이름
  - 수업 기간 (예: 2025년 9월 1일 ~ 30일)
  - 수업 내역 (날짜별 출결 상태)
  - 수업 횟수 합계
  - 회당 수업료
  - 총 청구 금액
  - 지불 기한 (발행일로부터 30일)

### 규칙 그룹 3: 정산 계산 규칙

- **수업 횟수 산정**:
  - 출석 = 1회
  - 지각/조퇴 = 1회 (출석으로 간주)
  - 결석 = 0회
  - 보강 = 1회 (추가 계산)
- **차액 처리 우선순위**:
  1. 다음 달 이월 (기본값)
  2. 환불
  3. 직접 협의
- **환불 가능 기간**: 결제일로부터 7일 이내
  - 7일 경과 후 환불은 선생님-학부모 직접 협의
- **크레딧 만료**: 없음 (무제한 이월)

### 규칙 그룹 4: 데이터 보관 규칙

- **청구서 보관 기간**: 영구 보관
  - 삭제 불가, 법적 증빙 자료
- **수정 이력 추적**: 모든 수정 사항 기록
  - 누가, 언제, 무엇을, 왜 수정했는지 로그
- **결제 영수증**: 자동 생성 및 영구 보관
  - PDF 다운로드 가능
- **통계 데이터**: 최근 3년치 유지
  - 그 이전은 연간 요약만

### 규칙 그룹 5: 보안 규칙

- **금액 정보 암호화**: 모든 금액 정보 암호화 저장
- **결제 정보 비노출**: 카드 번호 마지막 4자리만 표시
- **청구서 외부 공유 금지**: 앱 내에서만 조회 가능
  - PDF 다운로드는 워터마크 포함
- **접근 권한 엄격 제어**:
  - 선생님: 자신이 발송한 청구서만
  - 학부모: 자녀의 청구서만
  - 학생: 청구서 조회만 (결제 불가)

---

## 5. 사용자별 권한

### 과외 선생님

#### 할 수 있는 것
- ✅ 그룹별 수업료 설정 (회당 금액, 결제 방식, 정산 주기)
- ✅ 월별 청구서 자동 생성 및 수동 발송
- ✅ 청구서 내역 수정 (발송 전에만)
- ✅ 차액 처리 방법 선택 (이월, 환불 요청, 직접 협의)
- ✅ 월별/연도별 수입 통계 조회
- ✅ 학생별 결제 현황 확인 (결제 완료, 미결제, 연체)
- ✅ 영수증 PDF 다운로드 (세금 신고용)
- ✅ 청구서 발송 전 미리보기

#### 할 수 없는 것
- ❌ 청구서 발송 후 내역 수정 - 이유: 투명성 보장, 단 재발송은 가능
- ❌ 학부모 대신 결제 진행 - 이유: 금전 거래는 학부모만 가능
- ❌ 과거 청구서 삭제 - 이유: 법적 증빙 자료 보존
- ❌ 다른 선생님의 정산 내역 조회 - 이유: 개인정보 보호

### 학생

#### 할 수 있는 것
- ✅ 자신의 청구서 조회 (학부모와 동일하게 보임)
- ✅ 수업 내역 확인 (어느 날 무슨 수업 했는지)
- ✅ 출결 기록과 청구서 대조 확인
- ✅ 청구서 PDF 다운로드

#### 할 수 없는 것
- ❌ 결제 진행 - 이유: 미성년자, 학부모만 결제 가능
- ❌ 청구서에 대한 이의 제기 - 이유: 학부모가 해야 함
- ❌ 수업료 설정 확인 - 이유: 금액은 학부모-선생님 간 협의 사항
- ❌ 환불 요청 - 이유: 금전 거래는 학부모 권한

### 학부모

#### 할 수 있는 것
- ✅ 자녀의 청구서 조회 및 상세 내역 확인
- ✅ 청구서 결제 (카드, 계좌이체, 간편결제)
- ✅ 수업 내역과 출결 기록 교차 검증
- ✅ 결제 내역 및 영수증 조회
- ✅ 차액 발생 시 선생님에게 메시지 전송
- ✅ 환불 요청 (7일 이내)
- ✅ 월별 과외비 지출 통계 확인

#### 할 수 없는 것
- ❌ 청구서 금액 수정 - 이유: 선생님이 계산한 내역, 단 이의 제기는 가능
- ❌ 출결 기록 수정 - 이유: 선생님만 가능 (F-004)
- ❌ 수업료 설정 변경 - 이유: 선생님이 설정, 협의는 메시지로
- ❌ 다른 자녀의 청구서 결제 (한 번에) - 이유: 각각 개별 결제 필요

---

## 6. UI 요구사항

### 화면 1: 선생님 정산 대시보드

**레이아웃**:
- 상단: "이번 달 정산 현황" 요약 카드
  - 총 청구 금액, 결제 완료 금액, 미결제 학생 수
- 중앙: 학생별 청구 현황 카드 리스트
  - 각 카드: 학생 이름, 약정 vs 실제 수업 횟수, 청구 금액, 결제 상태
- 하단: "통계 보기", "영수증 다운로드" 버튼

**주요 컴포넌트**:
- **학생 카드**: 
  - 색상 구분: 초록색(결제 완료), 주황색(미결제), 빨간색(연체)
  - 카드 탭 시 상세 화면으로 이동
- **청구서 보내기 버튼**:
  - 주 색상, 크기 크게, 눈에 잘 띄게
  - 비활성화 조건: 출결 미기록, 수업료 미설정
- **경고 아이콘**: 
  - 약정과 실제 수업 횟수 차이가 있으면 "⚠️" 표시

**인터랙션**:
- 학생 카드 좌우 스와이프 시 빠른 액션
  - 왼쪽 스와이프: "청구서 보내기"
  - 오른쪽 스와이프: "메시지 보내기"
- 통계 버튼 탭 시 월별 수입 그래프 화면으로 전환

---

### 화면 2: 청구서 상세 (선생님용)

**레이아웃**:
- 상단: 청구서 요약
  - 기간, 학생 이름, 총 수업 횟수, 총 금액
- 중앙: 수업 내역 리스트
  - 각 수업: 날짜, 요일, 시간, 출결 상태, 메모
- 하단: "학부모에게 전송" 버튼

**주요 컴포넌트**:
- **수업 내역 아이템**:
  - 출석: 초록색 체크마크
  - 결석: 회색 X 표시 + 줄 그어짐
  - 보강: 파란색 별 표시
- **합계 금액**:
  - 큰 폰트, 굵게, 눈에 띄게
  - 차액 있으면 "+10만원" 또는 "-10만원" 표시
- **미리보기 모드**:
  - "학부모가 볼 화면" 스위치로 전환 가능

**인터랙션**:
- 각 수업 항목 탭 시 해당 수업의 진도 기록(F-005)으로 이동
- 전송 버튼 탭 시 확인 팝업 → 전송 완료 후 자동으로 메인 화면으로

---

### 화면 3: 청구서 확인 (학부모용)

**레이아웃**:
- 상단: 청구서 헤더
  - "O월 과외비 청구서"
  - 선생님 이름, 발송일
- 중앙: 청구 내역
  - 요약: 총 수업 횟수, 회당 금액, 합계
  - 상세: 날짜별 수업 리스트
- 하단: "결제하기" 버튼 (크고 눈에 띄게)

**주요 컴포넌트**:
- **결제 상태 뱃지**:
  - 미결제: 주황색 "결제 필요"
  - 결제 완료: 초록색 "결제 완료"
- **수업 내역 토글**:
  - 기본값: 요약만 보임
  - "상세 내역 보기" 탭 시 전체 리스트 펼쳐짐
- **이의 제기 버튼**:
  - 하단에 작게 "내역이 맞지 않나요?" 링크
  - 탭 시 선생님에게 메시지 작성 화면

**인터랙션**:
- 각 수업 항목 탭 시 해당 날짜의 진도 기록 확인 가능
- 결제하기 버튼 탭 시 결제 수단 선택 바텀 시트 표시
- 결제 완료 후 영수증 화면으로 자동 전환

---

### 화면 4: 결제 화면 (학부모용)

**레이아웃**:
- 상단: 결제 정보 요약
  - "O학생 O월 과외비"
  - 금액 강조
- 중앙: 결제 수단 선택
  - 카드, 계좌이체, 간편결제 (아이콘과 함께)
- 하단: "결제하기" 버튼

**주요 컴포넌트**:
- **결제 수단 라디오 버튼**:
  - 큰 터치 영역, 아이콘 + 텍스트
  - 선택 시 파란색 테두리
- **안전 거래 안내**:
  - 하단에 작게 "안전한 결제 환경" 아이콘 + 설명
- **로딩 인디케이터**:
  - 결제 진행 중 전체 화면 오버레이

**인터랙션**:
- 결제 수단 선택 즉시 입력 필드 표시
- 결제 중 뒤로가기 버튼 비활성화
- 결제 완료 시 성공 애니메이션 + 영수증 화면

---

### 화면 5: 월별 수입 통계 (선생님용)

**레이아웃**:
- 상단: 월 선택 드롭다운
- 중앙: 그래프 영역
  - 막대 그래프: 학생별 수입
  - 선 그래프: 월별 추이 (최근 6개월)
- 하단: 통계 요약
  - 총 수입, 평균 수업료, 학생 수

**주요 컴포넌트**:
- **그래프**:
  - 터치 시 상세 수치 팝업
  - 색상으로 학생 구분
- **영수증 다운로드 버튼**:
  - 우측 상단 아이콘 버튼
  - 탭 시 PDF 생성 및 공유

**인터랙션**:
- 그래프 막대 탭 시 해당 학생의 정산 상세로 이동
- 월 선택 시 그래프 부드럽게 애니메이션 전환
- 좌우 스와이프로 이전/다음 달 빠르게 이동

---

## 7. 다른 기능과의 연결

### 의존하는 기능 (이것들이 먼저 있어야 함)

- **F-001: 회원가입 및 로그인** - 이유: 사용자 식별 필요. 선생님/학생/학부모 역할 구분
- **F-002: 과외 그룹 생성 및 매칭** - 이유: 정산할 그룹이 있어야 함. 학부모 연결 필요
- **F-003: 수업 일정 관리** - 이유: 약정 수업 횟수와 일정 정보 필요
- **F-004: 출결 관리** - 이유: **핵심 의존**. 실제 수업 횟수 계산의 근거 데이터

### 이 기능에 의존하는 기능 (이것 다음에 만들어질 것들)

- **F-007: 알림 및 리마인더** - 이유: 청구서 발송 알림, 결제 완료 알림 등
- **F-008: 메시지 및 소통** - 이유: 청구서에 대한 문의, 차액 협의 등 소통 필요

### 함께 사용되는 기능 (밀접하게 연결됨)

- **F-005: 수업 기록 및 진도 관리** - 관계: 청구서에서 각 수업의 진도 기록으로 바로 이동 가능. 학부모가 "이날 뭘 배웠길래 돈을 내야 하나" 확인

---

## 8. 향후 고려사항 (2단계 이후)

### 기능 확장

- **정기 결제 (자동 결제)**:
  - 학부모가 카드 등록 후 매월 자동 결제
  - 왜 2단계인가: 금융 연동 복잡, PG사 계약 필요. MVP는 수동 결제로 충분
  
- **세금계산서 자동 발행**:
  - 선생님이 사업자 등록 시 세금계산서 자동 발급
  - 왜 2단계인가: 사업자 전용 기능, 개인 과외 선생님은 대부분 미등록

- **수업권 판매 (4회권, 8회권 등)**:
  - 학부모가 미리 수업권 구매 후 소진하는 방식
  - 왜 2단계인가: 비즈니스 모델이 복잡해짐, 환불 정책 추가 필요

- **그룹 수업 정산**:
  - 1:N 그룹 과외 시 인원별 분할 정산
  - 왜 2단계인가: 개인 과외부터 검증 후 확장

### 개선 아이디어

- **정산 자동화 레벨 업**:
  - 선생님 확인 없이 완전 자동 발송
  - 왜 나중인가: 초기에는 선생님이 직접 확인하는 게 신뢰 형성에 유리

- **할인/쿠폰 시스템**:
  - 학부모에게 추천인 쿠폰, 장기 할인 등 제공
  - 왜 나중인가: 마케팅 도구, MVP 단계에는 불필요

- **수업료 협상 기능**:
  - 앱 내에서 학부모-선생님이 수업료 협상하고 계약
  - 왜 나중인가: 민감한 기능, 오프라인 협의가 더 자연스러움

---

## 9. 성공 지표

### 정량적 지표

| 지표명 | 측정 방법 | 목표값 | 측정 시점 |
|--------|---------|--------|----------|
| 정산 기능 사용률 | 전체 선생님 중 청구서 발송한 비율 | 80% 이상 | 매월 말 |
| 수동 계산 대비 시간 절감 | 사용자 설문 (정산에 걸리는 시간) | 평균 50% 감소 (10분 → 5분) | 3개월 후 |
| 결제 완료율 | 청구서 발송 후 7일 이내 결제 비율 | 90% 이상 | 매월 |
| 정산 관련 분쟁 건수 | 고객센터 문의 중 금액 분쟁 비율 | 5% 미만 | 분기별 |
| 청구서 재발송 비율 | 오류로 인한 재발송 건수 | 10% 미만 | 매월 |

### 정성적 지표

- **사용자 피드백**: 
  - 선생님: "정산이 편해졌다", "돈 이야기 하기 부담스러운 게 줄었다"
  - 학부모: "투명하게 확인할 수 있어 좋다", "증빙이 명확해서 안심된다"
  
- **문제 해결도**: 
  - 문제 3(정산의 번거로움): 자동 계산으로 해결
  - 문제 5(금전 분쟁 위험): 시스템 기록으로 분쟁 예방
  - 문제 1(파편화된 도구): 정산도 통합 플랫폼 안에서 해결

---

## 10. 알려진 제약사항 및 트레이드오프

### 기술적 제약

- **PG사 연동 복잡도**: 
  - 카드 결제를 위해 PG(Payment Gateway)사와 계약 필요
  - 수수료 부담 (거래액의 2-3%)
  - 트레이드오프: 초기에는 계좌이체 위주로 유도, 카드 결제는 옵션

- **정산 타이밍**: 
  - 매월 말 자동 발송은 시스템 부하 증가 (모든 선생님이 동시에 발송)
  - 트레이드오프: 발송 시점을 몇 시간에 걸쳐 분산 처리

### 의도적 선택

- **환불 정책 7일 제한**: 
  - 선생님 보호를 위해 환불 기간 제한
  - 트레이드오프: 학부모 불편 가능성 있으나, 분쟁 최소화가 우선

- **청구서 수정 불가**: 
  - 발송 후에는 내역 수정 불가 (재발송만 가능)
  - 트레이드오프: 불편하지만 조작 방지 및 투명성 확보

- **선생님만 청구서 발송**: 
  - 학부모는 청구서를 요청할 수 없고 기다려야 함
  - 트레이드오프: 선생님의 주도권 보장, 학부모의 압박 방지

- **수업료 정보의 학생 비공개**: 
  - 학생은 청구서 조회는 가능하나 금액은 흐릿하게 처리
  - 트레이드오프: 미성년자에게 금전 정보 직접 노출 최소화

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| v1.0 | 2025-11-04 | 초안 작성 | Claude |

---

## 첨부 자료

- [ ] 청구서 화면 와이어프레임
- [ ] 결제 플로우 다이어그램  
- [ ] 경쟁 제품 정산 기능 비교표
- [ ] PG사 연동 기술 문서
